<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Темы</title>
</head>
<body>
<h2>Список тем</h2>

<a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/topics/create}">Создать новую тему</a>

<form method="get" action="#" style="margin-bottom: 20px;">
    <input type="text" name="search" placeholder="Поиск темы"
           th:value="${search}">
    <button type="submit">Найти</button>
</form>

<div th:if="${error}" style="color:red;">
    <p th:text="${error}"></p>
</div>

<div th:if="${#lists.isEmpty(topics)}">
    <p>Темы не найдены.</p>
</div>

<div th:each="topic : ${topics}">

    <h3 th:text="${topic.name}"></h3>

    <p th:text="${topic.description != null && !#strings.isEmpty(topic.description)
                ? topic.description : 'нет описания'}"></p>

    <div sec:authorize="hasRole('ADMIN')" >
        <a th:href="@{|/admin/topics/edit/${topic.id}|}">Редактировать</a>

        <form th:action="@{|/admin/topics/delete/${topic.id}|}" method="post" style="display:inline;">
            <button type="submit"
                    onclick="return confirm('Вы уверены, что хотите удалить эту тему?');">
                Удалить
            </button>
        </form>
    </div>

    <div sec:authorize="hasRole('TEACHER')">
        <a th:href="@{|/teacher/tests/create/${topic.id}|}">Создать тест</a>
    </div>

    <div>
        <a th:href="@{|/tests?topicId=${topic.id}|}">Посмотреть тесты</a>
    </div>

</div>

<div th:if="${totalPages == 1}">
    <span >Страница 1 из 1</span>
</div>

<div th:if="${totalPages > 1}">

    <a th:if="${currentPage != 1}"
       th:href="@{|/topics?page=1&search=${search}|}">1</a>
    <span th:if="${currentPage == 1}" >1</span>

    <span th:if="${currentPage > 4}">...</span>

    <span th:each="i : ${#numbers.sequence(currentPage-2, currentPage-1)}"
          th:if="${i > 1}">
        <a th:if="${i != currentPage}"
           th:href="@{|/topics?page=${i}&search=${search}|}"
           th:text="${i}"></a>
    </span>

    <span th:if="${currentPage != 1 and currentPage != totalPages}"
          th:text="${currentPage}"></span>

    <span th:each="i : ${#numbers.sequence(currentPage+1, currentPage+2)}"
          th:if="${i < totalPages}">
        <a th:href="@{|/topics?page=${i}&search=${search}|}" th:text="${i}"></a>
    </span>

    <span th:if="${currentPage < totalPages-3}">...</span>

    <a th:if="${currentPage != totalPages}"
       th:href="@{|/topics?page=${totalPages}&search=${search}|}"
       th:text="${totalPages}"></a>
    <span th:if="${currentPage == totalPages}"
          th:text="${totalPages}"></span>

</div>

</body>
</html>
